import{r as O,t as A,b as R,i as W,c as F,d as y,e as C}from"./Be5fLl4T.js";import{d as L}from"./BGl1DbLa.js";import{c as k}from"./Debgsfec.js";import{S as m}from"./D1NuK1r4.js";import{g as K}from"./s0RhsljA.js";import{s as B}from"./BNpPc0Re.js";import{o as p,p as N,d as v,q as D,e as Y,c as q,r as P}from"./HNIa2swf.js";import{t as Q}from"./CwWuMyGH.js";import{i as w}from"./9czO_RoD.js";import{u as V}from"./BRmgPntg.js";import"./CWj6FrbW.js";import"./69_IOA4Y.js";import{p as M,l as H,a as U,f as $,g as b,b as j,m as x,t as z,s as J,ag as g}from"./Dv5jDC8Z.js";import{s as G}from"./CnnFVxmh.js";import{i as X}from"./FbCjvpNA.js";import{c as I,a as T,b as Z}from"./BM_uyzAk.js";import{s as tt}from"./CevXMagP.js";import{i as et}from"./CM2QeVoh.js";import{p as E}from"./BbkaS_Cl.js";import{t as rt}from"./CZMG2GAD.js";function ot(e,t){O(2,arguments);var r=A(e).getTime(),s=R(t);return new Date(r+s)}var st=36e5;function qt(e,t){O(2,arguments);var r=R(t);return ot(e,r*st)}const at={workflowId:"WorkflowId",workflowType:"WorkflowType",timeRange:"StartTime",executionStatus:"ExecutionStatus",closeTime:"CloseTime",runId:"RunId"},nt=(e,t)=>!(e===null&&!p(t)||e===void 0||e===""||typeof e=="string"&&e==="undefined"),S=({value:e,type:t,conditional:r})=>t===m.BOOL?e.toLowerCase()==="true":t===m.KEYWORDLIST&&v(r)?e:`"${e}"`,it=e=>{const t=at[e]??e;return typeof t=="string"&&/\s/g.test(t)?"`"+t+"`":t},ut=(e,t,r,s="=",o,n)=>{const i=it(e);return r==="All"?"":n?`${i} ${r}`:p(s)?`\`${i}\` ${s} ${r}`:W(r)||F(r)?o||K(B)?`${i} ${s} "${y(r)}"`:`${i} BETWEEN "${y(r)}" AND "${C()}"`:N(s)?`\`${i}\` ${s} ${S({value:r,type:t,conditional:s})}`:`\`${i}\`${s}${S({value:r,type:t,conditional:s})}`},lt=(e,t)=>e.map(({attribute:r,type:s,value:o,conditional:n,operator:i,parenthesis:a,customDate:f})=>{if(nt(o,n)){let u=ut(r,s,o,n,t,f);return a==="("?u=`(${u}`:a===")"&&(u=`${u})`),i&&(u=`${u} ${i} `),u}}).filter(Boolean),ft=(e=[],t=!1)=>lt(e,t).join(""),_=e=>t=>t.toLowerCase()===e.toLowerCase(),mt=(e,t)=>e[t+1],ct=(e,t)=>e[t+2],pt=(e,t)=>e[t+3],dt=(e,t)=>e[t-2],gt=_(m.DATETIME),Tt=_(m.BOOL),h=()=>({attribute:"",type:m.KEYWORD,value:"",operator:"",parenthesis:"",conditional:""}),Et={ExecutionStatus:m.KEYWORD,StartTime:m.DATETIME,CloseTime:m.DATETIME,WorkflowId:m.KEYWORD,WorkflowType:m.KEYWORD,RunId:m.KEYWORD},Pt=(e,t=Et)=>{const r=Q(e),s=[];let o=h();if(!e)return[];try{return r.forEach((n,i)=>{const a=mt(r,i),f=ct(r,i);if(t[n])if(o.attribute=n,o.type=t[n],p(a)){const u=`${a} ${f}`,l=p(u)?pt(r,i):f;o.value=l.toLocaleLowerCase()==="null"?null:l}else if(gt(t[n])){const u=f,l=w(u);if(D(a)){const c=r[i+4],d=w(c);l&&d?(o.value=`BETWEEN "${u}" AND "${c}"`,o.customDate=!0):console.error("Error parsing Datetime field from query")}else l?o.value=u:console.error("Error parsing Datetime field from query")}else Tt(o.type)?(o.value=a.replace("=",""),o.conditional="="):o.value=f;if(!o.conditional&&Y(n)){const u=`${n} ${a}`;p(u)?o.conditional=u:o.conditional=n}q(n)&&(o.parenthesis=n),P(n)&&!D(dt(r,i))&&(o.operator=n,s.push(o),o=h()),i===r.length-1&&(s.push(o),o=h())}),s}catch(n){return console.error("Error setting filter parameters: ",n),[]}},ht=e=>{const t=e.filter(a=>a.attribute==="ExecutionStatus"&&a.value),r=e.filter(a=>a.attribute==="WorkflowId"&&a.value),s=e.filter(a=>a.attribute==="WorkflowType"&&a.value),o=e.filter(a=>a.attribute==="RunId"&&a.value),n=e.filter(a=>(a.attribute==="StartTime"||a.attribute==="CloseTime")&&a.value),i=[t,r,o,s,n].filter(a=>a.length);return i.forEach((a,f)=>{var u,l;a.length&&((u=i[f+1])!=null&&u.length)?a[a.length-1].operator="AND":a.length&&!((l=i[f+1])!=null&&l.length)&&(a[a.length-1].operator="")}),[...t,...r,...o,...s,...n]},yt=e=>(e.forEach((t,r)=>{const s=e[r-1];s&&!s.operator&&(s.operator="AND");const o=e[r+1];o||(t.operator=""),t.operator==="OR"&&(o==null?void 0:o.attribute)!==t.attribute?(t.parenthesis="",t.operator=""):t.operator==="OR"&&(s==null?void 0:s.operator)!=="OR"?t.parenthesis="(":(s==null?void 0:s.operator)==="OR"&&t.operator!=="OR"?t.parenthesis=")":t.parenthesis=""}),e),Qt=L((e,t,r=!1)=>{const s=r?ht(t):yt(t),o=ft(s);V({url:e,parameter:"query",value:o,allowEmpty:!1,clearParameters:[k]})},300);function Vt(e,t){M(t,!1);const r=x();let s=E(t,"key",8),o=E(t,"count",8,void 0),n=E(t,"replace",8,void 0);H(()=>(g(s()),g(n()),g(o())),()=>{J(r,rt(s(),{...n(),count:o()}))}),U(),et();var i=I(),a=$(i);{var f=l=>{var c=Z();z(()=>G(c,b(r))),T(l,c)},u=l=>{var c=I(),d=$(c);tt(d,t,"default",{},null),T(l,c)};X(a,l=>{b(r)!==s()?l(f):l(u,!1)})}T(e,i),j()}export{Vt as T,Pt as a,qt as b,yt as c,ot as d,h as e,ft as t,Qt as u};
