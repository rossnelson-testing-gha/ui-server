import{J as B,F as j,v as F,E as H,w as R,k as J,y as L,o as N,u as V,j as Y,ao as G}from"./Dv5jDC8Z.js";import{d as W,e as K}from"./BM_uyzAk.js";import{w as E}from"./s0RhsljA.js";import{g as C}from"./B4zHjFCP.js";import{t as O}from"./CZMG2GAD.js";import"./DhwiOCyc.js";import{s as k}from"./CTBtQUu0.js";import{r as m,a as f}from"./CzMPgtwl.js";import{v}from"./Dz_GI0CC.js";import{g as D}from"./BusX7ieA.js";import{e as $}from"./COoOr_Li.js";import{o as U,p as X}from"./Df1CJasG.js";function fe(e,s,t,n,a){var i=e,c="",r;B(()=>{if(c===(c=s()??"")){j&&F();return}r!==void 0&&(G(r),r=void 0),c!==""&&(r=H(()=>{if(j){R.data;for(var o=F(),d=o;o!==null&&(o.nodeType!==8||o.data!=="");)d=o,o=J(o);if(o===null)throw L(),N;W(R,d),i=V(o);return}var u=c+"",h=K(u);W(Y(h),h.lastChild),i.before(h)}))})}const ge=async(e,s,t,n=fetch)=>(a=100,i="")=>{const c=m("schedules",{namespace:e});return f(c,{params:{maximumPageSize:String(a),nextPageToken:i,...s?{query:s}:{}},request:n,onError:t}).then(({schedules:r,nextPageToken:o})=>({items:r,nextPageToken:o?String(o):""}))};async function ye(e,s=fetch){const t=m("schedule",e);return f(t,{request:s})}async function we(e,s=fetch){const t=m("schedule",e);return f(t,{request:s,options:{method:"DELETE"}})}async function Z({namespace:e,scheduleId:s,body:t}){let n="";const a=r=>{var o;return n=((o=r==null?void 0:r.body)==null?void 0:o.message)??`Error creating schedule: ${r.status}: ${r.statusText}`},i=m("schedule",{namespace:e,scheduleId:s}),{conflictToken:c}=await f(i,{options:{method:"POST",body:k({request_id:v(),...t})},onError:a});return{conflictToken:c,error:n}}async function ee({namespace:e,scheduleId:s,body:t}){let n="";const a=c=>{var r;return n=((r=c==null?void 0:c.body)==null?void 0:r.message)??`Error editing schedule: ${c.status}: ${c.statusText}`},i=m("schedule.edit",{namespace:e,scheduleId:s});return await f(i,{options:{method:"POST",body:k({request_id:v(),...t})},onError:a}),{error:n}}async function Se({namespace:e,scheduleId:s,reason:t}){const n={patch:{pause:t}},a=m("schedule.patch",{namespace:e,scheduleId:s});return await f(a,{options:{method:"POST",body:k({...n,request_id:v()})},onError:i=>console.error(i)})}async function ke({namespace:e,scheduleId:s,reason:t}){const n={patch:{unpause:t}},a=m("schedule.patch",{namespace:e,scheduleId:s});return await f(a,{options:{method:"POST",body:k({...n,request_id:v()})}})}async function _e({namespace:e,scheduleId:s,overlapPolicy:t}){const n={patch:{triggerImmediately:{overlapPolicy:t}}},a=m("schedule.patch",{namespace:e,scheduleId:s});return await f(a,{options:{method:"POST",body:k({...n,request_id:v()})}})}async function ve({namespace:e,scheduleId:s,overlapPolicy:t,startTime:n,endTime:a}){const i={patch:{backfillRequest:[{overlapPolicy:t,startTime:n,endTime:a}]}},c=m("schedule.patch",{namespace:e,scheduleId:s});return await f(c,{options:{method:"POST",body:k({...i,request_id:v()})}})}const I=e=>e?parseInt(e):0,te=(e,s,t,n)=>`${I(e)*60*60*24+I(s)*60*60+I(t)*60+I(n)}s`,se=({months:e=[],daysOfMonth:s=[],daysOfWeek:t=[]})=>{var r,o;const n=e.sort((d,u)=>parseInt(d)-parseInt(u)).join(","),a=s.sort((d,u)=>d-u).join(","),c=(((o=(r=t==null?void 0:t[0])==null?void 0:r.split(","))==null?void 0:o.length)>1?t[0].split(","):t).sort((d,u)=>parseInt(d)-parseInt(u)).join(",");return{month:n,dayOfMonth:a,dayOfWeek:c}},M=(e,s,t)=>{const{hour:n,minute:a,second:i,phase:c,cronString:r}=s,{preset:o,months:d,days:u,daysOfMonth:h,daysOfWeek:y}=t;if(o==="string"){const l=`${r}#${r}`;e.schedule.spec.cronString=[l],e.schedule.spec.calendar=[],e.schedule.spec.interval=[]}else if(o==="interval"){const l=te(u,n,a,i);e.schedule.spec.interval=[{interval:l,phase:c||"0s"}],e.schedule.spec.cronString=[],e.schedule.spec.calendar=[]}else{const{month:l,dayOfMonth:g,dayOfWeek:w}=se({months:d,daysOfMonth:h,daysOfWeek:y});e.schedule.spec.calendar=[{year:"*",month:o==="month"?l:"",dayOfMonth:o==="month"?g:"",dayOfWeek:o==="week"?w:"",hour:n,minute:a,second:i}],e.schedule.spec.interval=[],e.schedule.spec.cronString=[]}},Te=async({action:e,spec:s,presets:t})=>{const{namespace:n,name:a,workflowId:i,workflowType:c,taskQueue:r,input:o,encoding:d,messageType:u,searchAttributes:h}=e;let y;if(o)try{y=await $({input:o,encoding:d,messageType:u})}catch(w){S.set(`${O("data-encoder.encode-error")}: ${w==null?void 0:w.message}`);return}const l={schedule_id:a.trim(),searchAttributes:h.length===0?null:{indexedFields:{...D(h)}},schedule:{spec:{calendar:[],interval:[],cronString:[]},action:{startWorkflow:{workflowId:i,workflowType:{name:c},taskQueue:{name:r},input:y?{payloads:y}:null}}}};M(l,s,t),_.set(!0);const{error:g}=await Z({scheduleId:a,namespace:n,body:l});g?(S.set(g),_.set(!1)):setTimeout(()=>{S.set(""),_.set(!1),C(U({namespace:n}))},2e3)},be=async({action:e,spec:s,presets:t},n,a)=>{var A,q;const{namespace:i,name:c,workflowId:r,workflowType:o,taskQueue:d,input:u,encoding:h,messageType:y,searchAttributes:l}=e;let g;if(u)try{g=await $({input:u,encoding:h,messageType:y})}catch(p){S.set(`${O("data-encoder.encode-error")}: ${p==null?void 0:p.message}`);return}const{preset:w}=t,T={schedule_id:a,searchAttributes:l.length===0?null:{indexedFields:{...D(l)}},schedule:{...n,action:{startWorkflow:{...n.action.startWorkflow,workflowId:r,workflowType:{name:o},taskQueue:{name:d},...u!==void 0&&{input:g?{payloads:g}:null}}}}},b=(q=(A=T.schedule.action.startWorkflow)==null?void 0:A.header)==null?void 0:q.fields;if(b&&Object.keys(b).length>0)try{const p=Object.entries(b);for(const[Q,z]of p){const x=await $({input:k(z),encoding:"json/plain"});b[Q]=x[0]}}catch(p){S.set(`${O("data-encoder.encode-error")}: ${p==null?void 0:p.message}`);return}w==="existing"?T.schedule.spec=n.spec:(M(T,s,t),T.schedule.spec.structuredCalendar=[]),_.set(!0);const{error:P}=await ee({namespace:i,scheduleId:a,body:T});P?(S.set(P),_.set(!1)):setTimeout(()=>{C(X({namespace:i,scheduleId:c})),S.set(""),_.set(!1)},2e3)},_=E(!1),S=E(""),Ie=E("0");export{Te as a,Ie as b,ge as c,we as d,S as e,ye as f,ve as g,fe as h,_ as l,Se as p,be as s,_e as t,ke as u};
