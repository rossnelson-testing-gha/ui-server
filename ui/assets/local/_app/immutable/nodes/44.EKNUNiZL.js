import"../chunks/CWj6FrbW.js";import"../chunks/69_IOA4Y.js";import{p as Pe,R as ye,l as H,a as Me,g as e,b as Te,m as s,e as w,r as $,s as r,az as o,d as t,c as I,t as de,f as J,n as xe,aK as Oe}from"../chunks/Dv5jDC8Z.js";import{a as g,t as j,c as Qe,b as ke}from"../chunks/BM_uyzAk.js";import{i as Ie}from"../chunks/CM2QeVoh.js";import{e as ze,s as je,a as N}from"../chunks/CEr_ApTH.js";import{p as Ce}from"../chunks/C4EHgxxn.js";import{P as Ae}from"../chunks/PLLlBlGt.js";import{t as l}from"../chunks/CZMG2GAD.js";import{W as Fe}from"../chunks/wRxKVmx6.js";import{s as ce}from"../chunks/CnnFVxmh.js";import{a as Ke}from"../chunks/Cr1-wnh-.js";import{i as he}from"../chunks/FbCjvpNA.js";import{e as Ge,i as He}from"../chunks/CocFUsaO.js";import{o as Je}from"../chunks/s0RhsljA.js";import{P as Ne}from"../chunks/CQdY32MJ.js";import{B as Ve}from"../chunks/o0T750pR.js";import{C as Xe}from"../chunks/DV_BD6lz.js";import{C as Ye}from"../chunks/uEljFHmr.js";import{E as be}from"../chunks/lbyfKwPg.js";import{L as Ze}from"../chunks/CKG0nj-D.js";import{S as et,O as tt}from"../chunks/B5l2_Jlw.js";import{T as rt}from"../chunks/Cf5tKryT.js";import{a as ot,b as st}from"../chunks/COQaUMCx.js";import{a as at}from"../chunks/Cf9asbMp.js";import{w as qe}from"../chunks/D6vOFxie.js";import{e as nt}from"../chunks/COoOr_Li.js";import{s as lt}from"../chunks/CTBtQUu0.js";var it=j('<div class="text-center"><!> <p class="-mt-10"> </p></div>'),ut=j('<!> <div class="flex flex-col gap-1"><!></div> <div class="flex w-full flex-wrap items-end justify-end gap-4"><!></div>',1),dt=j('<div class="ml-auto"><!></div> <!>',1),ct=j('<div class="flex w-3/4 gap-4 max-2xl:w-full max-lg:flex-col"><!> <div class="flex w-full flex-col gap-2"><!></div></div>'),ft=j("<section><!></section>");function pt(V,X){Pe(X,!1);const[C,Y]=je(),q=()=>N(Ce,"$page",C),n=()=>N(qe,"$workflowRun",C),u=()=>N(at,"$authUser",C),_=s(),D=s(),d=s();var P=s(),R=s(),L=s(),M=s(),O=s(),Q=s();const{namespace:fe,workflow:pe,run:me}=q().params,Re={id:pe,runId:me};let c=s(),Z=s(),y=s(""),ee=s(""),z=s(!1),A=s(!0),ge=s(),te=s();Je(()=>{n().metadata||We()});const We=async()=>{const{settings:a}=q().data,f=await ot({namespace:fe,workflow:{id:pe,runId:me}},a,u()===null||u()===void 0?void 0:u().accessToken);ze(qe,ye(n).metadata=f,ye(n))},_e=()=>{r(z,!1),r(Z,e(c)),r(ee,e(y))},Be=async a=>{var f;r(z,!0);let x;try{r(te,e(y)?nt({input:e(y),encoding:"json/plain",encodeWithCodec:!1}):Promise.resolve(null)),x=await e(te)}catch{_e();return}r(ge,st({namespace:fe,workflow:Re,queryType:a,queryArgs:x?{payloads:x}:null},(f=q().data)===null||f===void 0?void 0:f.settings,u()===null||u()===void 0?void 0:u().accessToken).finally(()=>{_e()}))};H(()=>(o(O),o(M),o(L),n()),()=>{r(d,(r(O,r(M,r(L,n()===null||n()===void 0?void 0:n().metadata)===null||o(L)===void 0?void 0:o(L).definition)===null||o(M)===void 0?void 0:o(M).queryDefinitions)===null||o(O)===void 0?void 0:o(O).filter(a=>(a==null?void 0:a.name)!=="__stack_trace"))||[])}),H(()=>(e(c),o(Q),e(d)),()=>{r(c,e(c)||(r(Q,e(d)===null||e(d)===void 0?void 0:e(d)[0])===null||o(Q)===void 0?void 0:o(Q).name))}),H(()=>(e(Z),e(c),e(y),e(ee)),()=>{r(_,e(Z)!==e(c)||e(y)!==e(ee))}),H(()=>(o(R),o(P),n()),()=>{r(D,r(R,r(P,n().metadata)===null||o(P)===void 0?void 0:o(P).error)===null||o(R)===void 0?void 0:o(R).message)}),Me(),Ie();var re=ft(),Ee=w(re);{var Se=a=>{const f=t(()=>l("common.error-occurred")),x=t(()=>l("workflows.no-workers-running-message")),F=t(()=>{var p,i;return(i=(p=n().metadata)==null?void 0:p.error)==null?void 0:i.message});be(a,{get title(){return e(f)},get content(){return e(x)},get error(){return e(F)}})},Ue=(a,f)=>{{var x=p=>{var i=it(),W=w(i);Ze(W,{});var B=I(W,2),oe=w(B,!0);$(B),$(i),de(k=>ce(oe,k),[()=>l("workflows.no-workers-failure-message")],t),g(p,i)},F=p=>{var i=ct(),W=w(i);Xe(W,{class:"mt-7 flex h-fit w-full flex-col gap-2",children:(k,K)=>{var h=ut(),v=J(h);const E=t(()=>l("workflows.query-type"));et(v,{id:"query-select",get label(){return e(E)},class:"min-w-fit","data-testid":"query-select",required:!0,get value(){return e(c)},set value(m){r(c,m)},children:(m,ie)=>{var b=Qe(),U=J(b);Ge(U,1,()=>e(d),He,(ue,ve)=>{let we=()=>e(ve).name,De=t(()=>Oe(e(ve).description,""));tt(ue,{get value(){return we()},get description(){return e(De)},children:(Le,gt)=>{xe();var $e=ke();de(()=>ce($e,we())),g(Le,$e)},$$slots:{default:!0}})}),g(m,b)},$$slots:{default:!0},$$legacy:!0});var T=I(v,2),se=w(T);const S=t(()=>l("workflows.query-arg"));Ne(se,{get label(){return e(S)},get input(){return e(y)},set input(m){r(y,m)},$$legacy:!0}),$(T);var G=I(T,2),ae=w(G);const ne=t(()=>e(_)?"primary":"secondary"),le=t(()=>e(_)?null:"retry");Ve(ae,{get loading(){return e(z)},get variant(){return e(ne)},get leadingIcon(){return e(le)},get disabled(){return e(z)},$$events:{click:()=>Be(e(c))},children:(m,ie)=>{xe();var b=ke();de(U=>ce(b,U),[()=>e(_)?l("workflows.run-query"):l("workflows.refresh-query")],t),g(m,b)},$$slots:{default:!0}}),$(G),g(k,h)},$$slots:{default:!0}});var B=I(W,2),oe=w(B);Ke(oe,()=>Promise.all([e(ge),e(te)]),null,(k,K)=>{var h=t(()=>{var[U,ue]=e(K);return{result:U,_:ue}}),v=t(()=>e(h).result),E=t(()=>e(h)._),T=dt();const se=t(()=>typeof e(v)!="string"?lt(e(v)):e(v));var S=J(T),G=w(S);const ae=t(()=>l("workflows.json-formatting"));rt(G,{get label(){return e(ae)},labelPosition:"left",id:"json-formatting",get checked(){return e(A)},$$events:{change:()=>r(A,!e(A))}}),$(S);var ne=I(S,2);const le=t(()=>e(A)?"json":"text"),m=t(()=>l("common.copy-icon-title")),ie=t(()=>l("common.copy-success-icon-title")),b=t(()=>e(_)&&"opacity-50");Ye(ne,{get content(){return e(se)},get language(){return e(le)},get copyIconTitle(){return e(m)},get copySuccessIconTitle(){return e(ie)},testId:"query-result",get class(){return e(b)}}),g(k,T)},(k,K)=>{const h=t(()=>l("common.error-occurred")),v=t(()=>{var E;return(E=e(K))==null?void 0:E.message});be(k,{get title(){return e(h)},get error(){return e(v)}})}),$(B),$(i),g(p,i)};he(a,p=>{e(d).length?p(F,!1):p(x)},f)}};he(Ee,a=>{e(D)?a(Se):a(Ue,!1)})}$(re),g(V,re),Te(),Y()}var mt=j("<!> <!>",1);function Ft(V,X){Pe(X,!1);const[C,Y]=je(),q=()=>N(Ce,"$page",C),n=q().params.workflow;Ie();var u=mt(),_=J(u);const D=t(()=>`${l("workflows.queries-tab")} | ${n}`);Ae(_,{get title(){return e(D)},get url(){return q().url.href}});var d=I(_,2);Fe(d,{children:(P,R)=>{pt(P,{})},$$slots:{default:!0}}),g(V,u),Te(),Y()}export{Ft as component};
